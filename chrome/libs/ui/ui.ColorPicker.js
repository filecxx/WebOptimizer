
Std.ui.module("ColorPicker",{b:"widget",c:"change",e:{level:3,defaultClass:"StdUI_ColorPicker",fixedWidth:!0,fixedHeight:!0,minWidth:100,minHeight:100,paletteSize:150,value:"#000",palette:!0,colors:!0,colorBar:!0,attributes:!0},h:{rollY:0,alphaY:0,paletteX:0,paletteY:0},g:{render:function(){var e=this.opts;this.value(e.value)},enable:function(e){e?this[0].styleBack("opacity"):this[0].styleTo("opacity",.6)}},i:{initAttributes:function(){var t=this,o=t.DOMMap;return o.values.append(newDiv("_fields _rgb").append(Std.each("R G B A",function(e,t){return newDiv("_field").append([newDom("span","_label").html(t),o[t]=newDom("input","_"+t)])},!0))),o.values.append(newDiv("_fields").append(Std.each("H S V",function(e,t){return newDiv("_field").append([newDom("span","_label").html(t),o[t]=newDom("input","_"+t)])},!0))),o.values.append(o.HEX=newDom("input","_HEX")),o.values.appendTo(t).delegate("focusout","input",function(e){switch(Std.dom(this).className().substr(1)){case"R":case"G":case"B":t.rgb(o.R.value(),o.G.value(),o.B.value());break;case"H":case"S":case"V":t.hsv(o.H.value(),o.S.value(),o.V.value());break;case"HEX":t.hex(o.HEX.value())}}),t},initColors:function(){var e=this,t=e.opts,o=e.DOMMap,n=null,a=null,i=Std.dom.fragment(),l=document.createElement("div");if(l.className="_color",!0===t.colors?n=Std.convert.colors:isObject(t.colors)?n=t.colors:isString(t.colors)&&(n=t.colors.split(",")),isArray(n))for(var r,s=0,p=n.length;s<p;s++)(r=Std.dom.clone(l)).style.backgroundColor=n[s],i.appendChild(r);else if(isObject(n))for(var u in n)(r=Std.dom.clone(l)).style.backgroundColor=n[u],i.appendChild(r);return t.palette&&o.colors.marginLeft(4),o.colors.append(i).appendTo(e).delegate("click","._color",function(){e.enable()&&(null!==a&&a.removeClass("selected"),e.hex(Std.convert.rgb2hex(Std.convert.color((a=Std.dom(this).addClass("selected")).css("background-color")))))}),e},initPalette:function(){function t(e){o.move1(e.pageX-a.x,e.pageY-a.y).updateUI()}var o=this,n=o.DOMMap,a=null,i=Std.dom(o[0].document());return n.palettes.append([n.palette.append(n.position1.append(newDiv("inner"))),n.roll.append(n.position2),n.alpha.append(n.position3)]).appendTo(o),n.palette.mouse({unselect:!0,down:function(e){o.enable()&&(a=n.palette.offset(),n.position1.css("visibility","hidden"),o.move1(e.pageX-a.x,e.pageY-a.y).updateUI(),i.on("mousemove",t))},up:function(){i.off({mousemove:t}),n.position1.removeStyle("visibility")}}),o.initRoll()},initRoll:function(){var t=this,e=t.DOMMap,o=null,n=Std.dom(t[0].document()),a=function(e){t.move2(e.pageY-o).updateUI()},i=function(e){t.move3(e.pageY-o).updateUI()},l=function(e){n.off({mouseup:l,mousemove:a})},r=function(e){n.off({mouseup:r,mousemove:i})};return e.alpha.on("mousedown",function(e){if(t.enable())return o=this.offset().y,n.on({mouseup:r,mousemove:i}).once("selectstart",function(){return!1}),t.move3(e.pageY-o).updateUI(),!1}),e.roll.on("mousedown",function(e){if(t.enable())return o=this.offset().y,n.on({mouseup:l,mousemove:a}).once("selectstart",function(){return!1}),t.move2(e.pageY-o).updateUI(),!1}),t},initColorBar:function(){var e=this,t=e.DOMMap;return e[0].append(t.colorBar=newDiv("_colorBar").append(t.color=newDiv("_color"))),e},move1:function(e,t){var o=this,n=o.opts.paletteSize;return e<0?e=0:n<e&&(e=n),t<0?t=0:n<t&&(t=n),o.DOMMap.position1.css({left:(o._paletteX=e)-7,top:(o._paletteY=t)-7}),o},move2:function(e){var t=this,o=t.opts.paletteSize;return e<0?e=0:o<e&&(e=o),t.DOMMap.position2.css("top",(t._rollY=e)-4),t},move3:function(e){var t=this,o=t.DOMMap,n=t.opts.paletteSize;return e<0?e=0:n<e&&(e=n),o.position3.css("top",(t._alphaY=e)-4),o.color&&(n=(1-Std.convert.percent(t._alphaY,t.opts.paletteSize)/100).float(2),o.color.opacity(n),o.A&&o.A.value(n)),t},updateUI:function(){var e=this,t=e.hsv(),o=Std.convert.hsv2rgb(t.h,t.s,t.v),n=Std.convert.rgb2hex(o.r,o.g,o.b),a=(1-Std.convert.percent(e._alphaY,e.opts.paletteSize)/100).float(2),i=e.DOMMap;return e.opts.attributes&&(i.R.value(o.r),i.G.value(o.g),i.B.value(o.b),i.A.value(a),i.H.value(t.h),i.S.value(t.s),i.V.value(t.v),i.HEX.value(n)),i.alpha&&i.alpha.css("background-color",n),i.colorBar&&i.color.css("background-color",n),i.palette&&i.palette.css("background-color",Std.convert.rgb2hex(Std.convert.color("hsv("+t.h+",100,100)"))),e.emit("change",n)}},j:{value:function(e){return void 0===e?this.hex():(Std.is.color(e)&&isString(e)&&(e=Std.convert.color(e),this.rgb(e.r,e.g,e.b)),this)},rgb:function(e,t,o){if(void 0===e)return Std.convert.hsv2rgb(this.hsv());e=Std.convert.rgb2hsv(e,t,o);return this.hsv(e.h,e.s,e.v)},hex:function(e){if(void 0===e)return Std.convert.rgb2hex(this.rgb());e=Std.convert.hex2rgb(e);return this.rgb(e.r,e.g,e.b)},hsv:function(e,t,o){var n=this,a=n.opts.paletteSize;return void 0===e?{h:int((a-n._rollY)*(360/a)),s:int(n._paletteX*(100/a)),v:int((a-n._paletteY)*(100/a))}:(n.move1(n._paletteX=t/(100/a),n._paletteY=a-o/(100/a)),n.move2(n._rollY=a-e/(360/a)),n.updateUI())}},k:function(e,t){var o=e.DOMMap={};Std.each("client palettes palette roll alpha position1 position2 position3 values colors",function(e,t){o[t]=newDiv("_"+t)}),t.palette&&e.initPalette(),t.colors&&e.initColors(),t.attributes&&e.initAttributes(),t.colorBar&&e.initColorBar()},m:{rule:{content:"value"},html:{nodeName:["DIV"],create:function(e){this.value(e.html().trim())}}}});
"undefined;"