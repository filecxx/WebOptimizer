
Std.ui.module("Tree",function(){var a=Std.module({e:{tree:null,type:null,icon:null,text:"",href:"",target:"",className:"",value:null,items:null,parent:null,action:null,selected:!1,editable:!0,checked:!1,expanded:!1,checkable:!1,deferRender:!0,plugins:null},h:{loaded:!1},i:{createLines:function(){var e=this.DOMMap;return this[0].append([e.HLine=newDom("i","_line _horizontal"),e.VLine=newDom("i","_line _vertical")]),this},createCheckBox:function(){var e=this,t=e.DOMMap,t=t.checkbox=newDom("i","_checkbox").prependTo(t.anchor);return e.checked()&&t.addClass("checked"),e},createNodeIcon:function(){var e,t=this,n=t.opts.icon,i=t.DOMMap;return isEmpty(n)||i.icon||(e=i.icon=newDom("i","_icon"),i.text?e.insertBefore(i.text):e.appendTo(i.anchor),Std.icon.update(e,n,{width:null,height:null})),t},createChildNode:function(e){var t=this,n=t.opts,i=t.tree(),r=e.type;return!e||"checkable"in e||(e.checkable=i.checkable()),(e=r&&r in i._types?i.makeNodeOption(r,e):e).parent=t,e.checked=n.checked,e.checkable=n.checkable,e.expanded=i.opts.expanded,e.deferRender=n.deferRender,new a(i,e)},createChildNodes:function(e,t){function n(e){i.append(e),i.tree().emit("itemDataLoad",[i,e],!0),o.hand.removeClass("_loading"),t&&t.call(i,e)}var i=this,r=i.opts.items,o=i.DOMMap;return i._loaded||(o.ul=newDom("ul","_container_ul").appendTo(i[0]),(i._loaded=!0)!==e&&o.ul.hide(),isArray(r)?(i.append(r),t&&t.call(i,r)):isFunction(r)?(o.hand.addClass("_loading"),r.call(i,n)):(isString(r)||isObject(r))&&(o.hand.addClass("_loading"),Std.ajax.json(r).success(n)),i.opts.items=null),i}},j:{type:function(e){return this.opt("type",e)},value:function(e){return this.opt("value",e)},parent:function(e){return this.opt("parent",e)},checkable:function(e){return this.opt("checkable",e)},editable:function(e){return this.opt("editable",e)},index:function(){return this.parent().indexOf(this)},expanded:function(e,t){return this.opt("expanded",e,function(){this.expand(e,t||!1)})},expandAll:function(){var e=this.expanded(!0,!1);return e._items.items(function(e,t){t.expandAll()}),e},collapseAll:function(){var e=this.expanded(!1,!1);return e._items.items(function(e,t){t.collapseAll()}),e},parentOf:function(e){for(;e=e.parent();)if(e===this)return!0;return!1},text:function(e){return this.opt("text",e,function(){this.DOMMap.text.text(e)})},icon:function(e){var t=this,n=t.DOMMap;return t.opt("icon",e,function(){n.icon?Std.icon.update(n.icon,e,{width:null,height:null}):t.createNodeIcon()})},target:function(e){return this.opt("target",e,function(){this.DOMMap.anchor.attr("target",e)})},href:function(e){return this.opt("href",e,function(){isEmpty(e)?this[0].removeAttr("href"):this.DOMMap.anchor.attr("href",e)})},count:function(){var e=this,t=e.opts;return e._loaded?e._items.length:isArray(t.items)?t.items.length:0},indexOf:function(e,t){var n=this,i=n.opts;return!n._loaded&&i.items&&n.createChildNodes(),n._items.indexOf(e,t)},items:function(e,t){var n=this,i=n.opts;return!n._loaded&&i.items&&n.createChildNodes(),n._items.items(e,t)},path:function(e){for(var t=this,n=[];t instanceof a&&n.push("text"===e?t.text():t.index()),t=t.parent(););return n.reverse().join("/")},plugin:Std.func(function(e,t){var n=this[0];if(void 0===t)return n.plugin(e);n.plugin(e,t)},{each:[isObject]}),removePlugin:Std.func(function(e){return this[0].removePlugin(e),this}),tree:function(n){var e=this;return e.opt("tree",n,function(){n.opts.lines?e.DOMMap.VLine||e.createLines():e.DOMMap.VLine&&(e.DOMMap.VLine.remove(),e.DOMMap.HLine.remove()),e._items.items(function(e,t){t.tree(n)})})},update:function(){var e=this,t=e.opts,n="_container_li "+t.className;return 0===e._items.length&&isEmpty(t.items)?n+=" _empty":t.expanded&&(e._loaded||e.createChildNodes(),n+=" _expanded"),e[0].className(n),e},selected:function(n){var i=this,r=i.opts,o=i.tree();return i.opt("selected",n,function(){var e=o.opts.selectionMode,t=o.wholeRow()?i.DOMMap.node:i.DOMMap.anchor;"none"!==e&&(t.toggleClass("selected",n),!0===n?("item"===e&&o.clearSelected(),o._selectedItems.push(i)):o.clearSelected(i),!0===n&&r.action&&(t=Std.action(r.action))&&t.call(i),o.emit("itemSelected",[i,n],!0))})},checked:function(n){var e=this,t=e.opts,i=e.tree();return e.opt("checked",n,function(){!e._loaded&&isArray(t.items)&&e.createChildNodes(),"checkedItems"===i.selectionMode()&&e.selected(n),!0===n?i._checkedItems.push(e):i.clearChecked(e),e.DOMMap.checkbox&&e.DOMMap.checkbox.toggleClass("checked",n),e._items.items(function(e,t){t.checked(n)}),i.emit("itemChecked",n)})},insertTo:function(e,t){var n=this,i=n.opts,r=n.tree().selectionMode();return(i.selected||i.checked&&"checkedItems"===r)&&n.selected(!0),void 0===t||-1===t?e.append(n[0]):isNumber(t)&&e.insert(n[0],t),n.update()},insertBefore:function(e,t){return void 0===t?e.parent().insertBefore(this,e):-1!==(t=this.indexOf(t))&&this.insert(e,t),this},insertAfter:function(e,t){return void 0===t?e.parent().insertAfter(this,e):-1!==(t=this.indexOf(t))&&this.insert(e,t+1),this},insert:function(e,t){var n,i=this,r=i.opts,o=i.DOMMap;return(isString(e)||isNumber(e))&&(e={text:e}),i._loaded?(e instanceof a?e.parent()===i?(n=e.index(),i._items.remove(n),isNumber(t)&&n<t&&t--):(e.opts.tree!==r.tree&&e.tree(r.tree),e.parent()._items.remove(e.index()),e.parent().update(),e.parent(i)):e=i.createChildNode(e),e.opts.name?i._items.insert(e.opts.name,e,t):i._items.insert(e,t),e.insertTo(o.ul,t)):(null===r.items&&(r.items=[]),isArray(r.items)&&r.items.insert(e,t)),i.update()},append:function(t){function e(e){if(!n._loaded)return null===i.items&&(i.items=[]),isArray(i.items)&&i.items.push(t);(e=isString(e)||isNumber(e)?{text:e}:e)instanceof a?(e.opts.tree!==i.tree&&e.tree(i.tree),e.parent()._items.remove(e.index()),e.parent().update(),e.parent(n)):e=n.createChildNode(e),e.opts.name?n._items.append(e.opts.name,e):n._items.push(e),e.insertTo(r.ul)}var n=this,i=n.opts,r=n.DOMMap;if(isString(t)||isNumber(t))e({text:t});else if(isArray(t))for(var o=0,s=t.length;o<s;o++)e(t[o]);else t&&e(t);return n.update()},expand:function(e,t){var n=this,i=n.opts,r=n.tree(),o=n.DOMMap;if(!0===e&&!n._loaded)return n.createChildNodes(null,function(){n.expand(e,t)});if(0===n._items.length)return n;if(n[0].toggleClass("_expanded",i.expanded=e),!1===t)return o.ul.visible(e),n;var s=o.ul.show().offsetHeight(),i=o.ul.css("overflow","hidden").width(),r=r.height()-n[0].position().y,a=0;return(a=(r=s<r?s:r)/3)<80&&(a=100),!0===e?o.ul.height(0).width(i).animateTo({height:r},{duration:a,timingFunction:"ease-out"},function(){o.ul.height(s).removeStyle("overflow width height")}):o.ul.width(o.ul.width()).height(r).animateTo({height:0},{duration:a,timingFunction:"ease-in"},function(){o.ul.removeStyle("overflow width height").hide()}),n},destroy:function(){var e=this,t=e.opts,n=t.tree;return t.selected&&t.tree.clearSelected(e),t.checked&&t.tree.clearChecked(e),0<e._items.length&&(e._items.items(function(e,t){t.destroy()}),e._items.clear()),e[0].remove(),n._currentItem===e&&(n._currentItem=null),e},remove:function(n){var e=this,i=e.opts,t=i.tree,r=null;return void 0===n?e.destroy():isNumber(n)?(!e._loaded&&isArray(i.items)?i.items.remove(n):n<e._items.length&&(r=e._items._list[n],e._items.remove(n)),e.update()):isString(n)?(!e._loaded&&isArray(i.items)?Std.each(i.items,function(e,t){if(t.name===n)return i.items.remove(e)}):(r=e._items.items(n))&&e._items.remove(n),e.update()):isObject(n)&&((r=e._items.items(n))&&e._items.remove(n),e.update()),null!==r&&(t.rendered&&t.emit("itemRemove",r),r.destroy()),e}},k:function(e,t){var n,i=this,t=i.init_opts(t),r=i.DOMMap={};r.node=newDiv("_node").append([r.hand=newDom("i","_hand"),r.anchor=newDom("a","_anchor")]).appendTo(i[0]=newDom("li","_container_li "+t.className+(isEmpty(t.items)?" _empty":"")).data("node",i));t.action&&(n=Std.action(t.action))&&n.bind(this),t.tree=e,t.checkable&&i.createCheckBox(),i.createNodeIcon(),t.color&&r.anchor.color(t.color),t.href&&i.href(t.href),t.target&&i.target(t.target),t.text&&r.anchor.append(r.text=newDom("span").html(t.text)),i._items=Std.items(),e.opts.lines&&i.createLines(),!t.items||t.deferRender&&!t.expanded||i.createChildNodes(t.expanded),t.plugins&&i.plugin(t.plugins)}});return{b:"widget",c:"clear selectionModeChange itemDrop dataSourceMessage itemClick itemDblClick itemRename itemRemove itemChecked itemSelected itemDataLoad",e:{defaultClass:"StdUI_Tree",level:4,items:null,lines:!1,iconWidth:"auto",iconHeight:"auto",expanded:!1,checkable:!1,editable:!1,droppable:!1,deferRender:!0,wholeRow:!1,theme:"default",itemHeight:24,itemCursor:"default",itemEditMode:"dblclick",dataSource:null,itemContextMenu:null,selectionMode:"items"},n:{initItemContextMenu:function(e){var t={handle:this.opts.wholeRow?"li._container_li > ._node":"li._container_li > ._node > a._anchor"};isArray(e)?t.items=e:isObject(e)&&Std.extend(t,e),this._itemContextMenu=this[0].plugin("contextMenu",t),this._itemContextMenu.on("hit",function(e){this.item(Std.dom(e).parent("._container_li").data("node"))})},initKeyboardEvents:function(){var t=this;t[0].on("keydown",function(e){113===e.keyCode&&t.editable()&&(e=t._selectedItems,isEmpty(e))})},initCheckboxEvents:function(){var n=this;n[0].on("mouseenter","._container_li > ._node > a._anchor > i._checkbox",n._checkboxEvents=function(e){var t=this.parent("li").data("node");n.enable()&&this.mouse({auto:!1,click:function(){t.checked(!t.checked())},dblclick:function(e){e.stopPropagation()}},e)})},initDataSource:function(){var n=this,e=n.opts,i=n.dataSource=Std.dataSource(e.dataSource);i.on("message",function(e){n.emit("dataSourceMessage",e)}).call("items",{value:e.value},function(e,t){n.append(t)}),n.on({itemRename:function(e,t){i.call("itemRename",{item:e,text:t,value:e.value()})},itemRemove:function(e){i.call("itemRemove",{item:e,value:e.value()})},itemDrop:function(e){i.call("itemDrop",{item:e,index:e.index(),value:e.value()})}})},initEvents:function(){function t(e,i,t){r.enable()&&e.mouse({auto:!1,click:function(e){r.editable()&&i.editable()&&n.itemEditMode.split(" ").has("click")&&r.editNode(i),r.emit("itemClick",[i,e],!0)},dblclick:function(e){r.editable()&&i.editable()&&n.itemEditMode.split(" ").has("dblclick")?r.editNode(i):i.expand(!i.expanded()),r.emit("itemDblClick",[i,e],!0)},down:function(e){var t=r.selectionMode(),n=i.selected();"item"==t?r._selectedItems[0]!==i&&(r.clearSelected(),i.selected(!0)):"items"==t&&(e.ctrlKey?i.selected(!n):n&&1===r._selectedItems.length&&r._selectedItems[0]===i||(r.clearSelected(),i.selected(!n))),r._currentItem=i}},t)}var r=this,n=r.opts;r[0].unselect(!0).on("dragstart",Std.func(!1)).on("mouseenter","i._hand",function(e){var t=this.parent("li").data("node");r.enable()&&this.mouse({auto:!1,down:function(e){},click:function(){t.expand(!t.expanded())},dblclick:function(e){e.stopPropagation()}},e)}).on("mousedown",function(e){r[0].is(e.target)&&(r._currentItem=null)}).on("mouseenter","li._container_li > ._node",function(e){n.wholeRow&&t(this,this.parent("li").data("node"),e)}).on("mouseenter","li._container_li > ._node > a._anchor",function(e){n.wholeRow||t(this,this.parent("li").data("node"),e)})}},g:{render:function(){var e=this,t=e.opts;t.checkable&&e.initCheckboxEvents(),t.droppable&&e.initDropEvents(),e.updateStyle(),e.initEvents(),e.initKeyboardEvents(),t.dataSource&&e.initDataSource()},destroy:function(){this._items.clear(),this._itemContextMenu=null,this._CSSStyle.remove(),this._checkedItems.clear(),this._selectedItems.clear()},remove:function(e){var t=null;void 0!==e&&(t=this._items.items(e))&&(this._items.remove(e),this.rendered&&this.emit("itemRemove",t),t.destroy())}},i:{update:function(){},wholeRow:function(e){return this.opt("wholeRow",e)},editNode:function(n,i){var r=this;return r.rendered&&n.DOMMap.text.editText({changeText:!1,apply:function(e,t){e!==t&&(n.text(e),r.emit("itemRename",[n,e,t],!0)),isFunction(i)&&i.call(r,n,e,t)}}),r},makeNodeOption:function(e,t){var n,i=this._types[e];for(n in i)n in t||(t[n]=i[n]);return t},createChildNode:function(e){var t=this,n=t.opts,i=e.type;return(e=i&&i in t._types?t.makeNodeOption(i,e):e).parent=t,e.expanded=n.expanded,e.checkable=n.checkable,e.deferRender=n.deferRender,new a(t,e)},updateStyle:function(){var e=this,t=e.opts,n={},i=e.itemHeight()-2,r="auto"===t.iconWidth?i:t.iconWidth,r={"input._input":{height:i+"px",lineHeight:i+"px"},"i._line._horizontal":{top:(2+i)/2-1+"px",left:(2+i)/2+"px",width:(2+i)/2+1+"px"},"i._line._vertical":{top:0,left:(2+i)/2-1+"px",height:"100%"},"i._checkbox":{margin:(i-16)/2+"px"},"i._hand":{margin:(i-12)/2+"px"},"i._icon":{width:r+"px",height:r+"px",marginTop:(i-("auto"===t.iconHeight?i:t.iconHeight))/2+"px"},"li._container_li":{marginLeft:i+"px"},"a._anchor":{cursor:t.itemCursor,height:i+"px",lineHeight:i+"px"}};return n["."+e._identifier]={">":{"ul > li._container_li":{marginLeft:0},"ul > li._container_li:first-child":{">":{"i._line._vertical":{top:(2+i)/2+"px"}}},"ul > li._container_li:last-child":{">":{"i._line._vertical":{height:(2+i)/2+"px"}}," ":{"li._container_li:last-child > i._line._vertical":{height:(2+i)/2+"px"}}}}," ":r},e._CSSStyle.clear().append(n),e},initDropEvents:function(){function t(e){var t="",n=e.pageY-i;"in"!==r&&.35*l<n&&n<.65*l||d?t="in":"before"!==r&&n<.35*l?h(e.containment,t="before"):"after"!==r&&.65*l<n&&h(e.containment,t="after"),""!==t&&r!==t&&("in"!==t?(c[0].removeClass("_dropin"),u.css({left:e.containment.offset().x+c.DOMMap.anchor.position().x,width:c.DOMMap.anchor.width()}).show()):(u.hide(),c[0].addClass("_dropin")),p(e.helper,t))}var n=this,i=null,r=null,o=!1,s=null,a=null,c=null,d=!1,l=0,u=null,h=function(e,t){u.css("top","before"===t?e.offset().y-1:e.offset().y+(l-3))},p=function(e,t){e.className("StdUI_Tree_Helper _"+((r=t)?" _"+t:""))};return n[0].plugin("drop",{items:"li._container_li > ._node > ._anchor",opacity:.9,forceHelperSize:!1,check:function(){return n.enable()}}).helper("rect").helperClass("StdUI_Tree_Helper").accept(".StdUI_Tree,.StdUI_Tree li._container_li").on({move:function(e){!0===o&&s.dom!==e.containment.dom&&t(e)},start:function(e){l=n.itemHeight()+2,u=newDiv("StdUI_Tree_PositionTips").appendTo("body"),e.helper.html((a=(s=e.self.parent("li")).data("node")).text())},leave:function(e){u.visible(o=!1),c[0].removeClass("_dropin"),c=null,p(e.helper)},stop:function(){o=!1,u.remove(),c&&c[0].removeClass("_dropin")},enter:function(e){if(i=e.containment.offset().y,d=e.containment.not("._container_li"))c=e.containment.ui();else if(a.parentOf(c=e.containment.data("node")))return;s&&!s.not(e.containment)||(o=!0,s&&t(e))},drop:function(e){!1!==o&&c&&(o&&a.tree()!==(d?c:c.tree())&&n.clearSelected(a).clearChecked(a),"in"===r||d?(c._loaded||d||c.createChildNodes(!1),c.append(a).update()):"before"==r?a.insertBefore(c):"after"===r&&a.insertAfter(c),n.emit("itemDrop",[a,e],!0))}}),n}},j:{count:function(){return this._items.length},currentItem:function(){return this._currentItem||null},selectedItem:function(){return this._selectedItems[0]||null},selectedItems:function(){return Array.from(this._selectedItems)},checkedItem:function(){return this._checkedItems[0]||null},checkedItems:function(){return Array.from(this._checkedItems)},selectionMode:function(e){return this.opt("selectionMode",e,function(){this.emit("selectionModeChange",e)})},editable:function(e){return this.opt("editable",e)},itemEditMode:function(e){return this.opt("itemEditMode",e)},itemHeight:function(e){return this.opt("itemHeight",e,function(){this.rendered&&this.update()})},indexOf:function(e,t){return this._items.indexOf(e,t)},items:function(e,t){return this._items.items(e,t)},checkable:function(e){return this.opt("checkable",e,function(){!0===e&&this.initCheckboxEvents()})},select:function(e){return(e=this._items.items(e))&&e.selected(!0),this},expandAll:function(){return this.items(function(e,t){t.expandAll()}),this},collapseAll:function(){return this.items(function(e,t){t.collapseAll()}),this},parentOf:function(e){for(;e=e.parent();)if(e===this)return!0;return!1},itemContextMenu:function(e){var t=this._itemContextMenu;return void 0===e?t||null:(this.initItemContextMenu(e),this)},types:Std.func(function(e,t){var n=this._types;if(isString(e)&&void 0===t)return n[e];n[e]=Std.extend({},t)},{each:[isArray,isObject]}),insertBefore:function(e,t){t=this.indexOf(t);return-1!==t&&this.insert(e,t),this},insertAfter:function(e,t){t=this.indexOf(t);return-1!==t&&this.insert(e,t+1),this},insert:function(e,t){var n,i=this;return(e=isString(e)||isNumber(e)?{text:e}:e)instanceof a?e.parent()===i?(n=e.index(),i._items.remove(n),isNumber(t)&&n<t&&t--):(e.opts.tree!==i&&e.tree(i),e.parent()._items.remove(e.index()),e.parent().update(),e.parent(i)):e=i.createChildNode(e),e.opts.name?i._items.insert(e.opts.name,e,t):i._items.insert(e,t),e.insertTo(i[1],t),i},append:Std.func(function(e){var t=this;(e=isString(e)||isNumber(e)?{text:e}:e)&&(e instanceof a?(e.opts.tree!==t&&e.tree(t),e.parent()._items.remove(e.index()),e.parent().update(),e.parent(t)):e=t.createChildNode(e),e.opts.name?t._items.append(e.opts.name,e):t._items.push(e),e.insertTo(t[1]))},{each:[isArray]}),clearSelected:function(e){function n(e){e.opts.selected=!1,e.DOMMap[i.wholeRow?"node":"anchor"].removeClass("selected")}var t=this,i=t.opts;return void 0===e?(Std.each(t._selectedItems,function(e,t){n(t)}),t._selectedItems.clear()):e instanceof a&&(n(e),t._selectedItems.remove(t._selectedItems.indexOf(e))),t},clearChecked:function(e){function n(e){e.opts.checked&&(e.opts.checked=!1,e.DOMMap.checkbox.removeClass("checked"))}var t=this;return void 0===e?(Std.each(t._checkedItems,function(e,t){n(t)}),t._checkedItems.clear()):e instanceof a&&(n(e),t._checkedItems.remove(t._checkedItems.indexOf(e))),t},reload:function(){var n=this,e=n.opts,t=e.dataSource;return t&&t.read("items",{value:e.value},function(e,t){n.clear(),n.append(t)}),n},find:function(i){var r=this,o=[],s=function(e){var t=e.opts;if(isFunction(i)){var n=i.call(r,e);if(!1===n)return!1;!0===n?o.push(e):void 0!==n&&o.push(n)}else"name"!==(n=i.type)&&"value"!==n&&"text"!==n&&"href"!==n||t[n]===i.data&&o.push(e);return e.items(function(e,t){return s(t)})},a=function(e,n){return e.items(function(e,t){if(t.opts.text===i[n])return n+1===i.length?t:a(t,n+1)})||void 0};return isString(i)?(i=i.split("/"),a(this,0)||null):(r.items(function(e,t){return s(t)}),o)},clear:function(){var e=this;return e[1].clear(),e._items.clear(),e._checkedItems.clear(),e._selectedItems.clear(),e.emit("clear")}},k:function(e,t){e[0].addClass(e._identifier=t.defaultClass+Date.now()).append(e[1]=newDom("ul","_container_ul")),e._items=Std.items(),e._CSSStyle=new Std.css,e._types={},e._checkedItems=[],e._selectedItems=[],t.types&&e.types(t.types),t.lines&&e.addClass("_hasLine"),t.items&&e.append(t.items),t.itemContextMenu&&e.initItemContextMenu()},m:{rule:{children:"append"},html:{nodeName:["DIV"],create:function(e){function r(e){var t,n=e.attr("std-icon"),i={text:e.attr("title"),type:e.attr("std-type"),name:e.attr("std-name"),action:e.attr("std-action"),items:e.children(function(e,t){return r(t)})};return isEmpty(n)||(i.icon=n),"A"===e.nodeName()&&(n=e.attr("target"),t=e.attr("href"),isString(n)&&(i.target=n),isString(t)&&(i.href=t)),Std.extend(i,Std.options.get(e),3)}this.append(e.children(function(e,t){return r(t)}))}}}}});
"undefined;"