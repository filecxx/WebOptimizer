
Std.ui.module("ListItem",{b:"Item",e:{defaultClass:"StdUI_ListItem",iconHeight:16,iconWidth:16,height:24,value:null},g:{height:function(e){var t=this,i=t.opts,n=t.DOMMap;isNumber(e)||(e=t.height()),n.icon&&n.icon.marginTop(Math.floor((e-i.iconHeight)/2)),t[0].lineHeight(e-t.boxSize.height)}}}),Std.ui.module("List",{b:"widget",c:"itemClick itemRename itemRemove itemSelected itemSort clear receive focus blur dataSourceMessage",e:{defaultClass:"StdUI_List",level:4,type:"default",itemType:"ListItem",itemEditMode:"dblclick",valueType:"list_value",value:null,items:null,editable:!1,sortable:!1,template:null,dataSource:null,width:"auto",height:"auto",itemHeight:24,itemWidth:80,iconWidth:16,iconHeight:16,selectionMode:"single"},n:{initEvents:function(){var e=this;e[0].focussing(function(){e.enable()&&e.addClass("focused").emit("focus")},function(){e.emit("blur").removeClass("focused")},!1)},initDataSource:function(){var i=this,e=i.opts,n=i.dataSource=Std.dataSource(e.dataSource);n.on("message",function(e){i.emit("dataSourceMessage",e)}).call("items",{value:e.value},function(e,t){i.append(t)}),i.on({itemRemove:function(e){n.call("itemRemove",{item:e,value:e.value()})},itemRename:function(e,t){n.call("itemRename",{item:e,text:t,value:e.value()})},itemDrop:function(e,t){t.traitor||n.call("itemDrop",{item:e,index:t.index,value:e.value()})}})},initSortPlugin:function(){var n=this;n[1].plugin("sort",Std.extend({items:"> *",accept:"."+n.opts.defaultClass+" ._items",helper:"clone",behavior:"insert",forceHelperSize:!0,check:function(){return n.sortable()&&n.enable()}},n.opts.sortOption)).on({sort:function(e){var t=n._items.items(e.self);e.traitor?n.clearSelected(t):(n._items.remove(t),n._items.insert(t,e.index)),n.emit("itemSort",[t,e],!0)},receive:function(e){var t=e.sender.parent().ui(),i=t._items.items(e.self);t._items.remove(i),n[1].insert(i,e.index),n._items.insert(i,e.index)}})},initItemEvents:function(){var a=this,t=a.opts,i=t.itemEditMode.split(" "),l=t.selectionMode;a[1].delegate("mouseenter","> *",function(e){var s=this.index(),r=a._items.items(s);a.enable()&&r&&Std.dom(r).mouse({auto:!1,dblclick:function(){t.editable&&i.has("dblclick")&&a.editItem(r)},click:function(){t.editable&&i.has("click")&&a.editItem(r),a.emit("itemClick",r)},down:function(e){var t,i,n;t=s,i=r,n=e,"multi"===l?(n.ctrlKey||a.clearSelected(),a._selectedItems.has(i)?a.clearSelected(i):a.select(i)):"none"!==l&&(a.clearSelected(),a.select(t)),e.preventDefault()},up:function(){0}},e)})}},g:{width:function(e){isNumber(e)&&this[1].width(e-this.boxSize.width)},height:function(e){isNumber(e)&&this[1].height(e-this.boxSize.height)},render:function(){var e=this,t=e.opts;e._items.items(function(e,t){isWidget(t)&&t.render()}),t.dataSource&&e.initDataSource(),t.value&&e.value(t.value)},enable:function(i){this._items.items(function(e,t){isWidget(t)&&t.enable(i)}),this[0].unselect(!i)},destroy:function(){this._items.items(function(e,t){isWidget(t)&&t.destroy()})},remove:Std.func(function(e){var t,i=this,n=i._selectedItems;isObject(e)&&(e=i._items.indexOf(e)),(isNumber(e)||isString(e))&&(t=i._items.items(e),(isWidget(t)||Std.is.DOM(t))&&(n.has(t)&&i.clearSelected(t),i._items.remove(e),i.emit("itemRemove",t),t.destroy()))},{each:[isArray]})},i:{editItem:function(i){var n=this;return(i=n.items(i))instanceof Std.ui("ListItem")&&i.DOMMap.text.editText({changeText:!1,apply:function(e,t){e!==t&&(i.text(e),n.emit("itemRename",[i,e,t],!0))}}),n},createTemplateItem:function(e){var t=this.opts;return Std.ui("TemplateItem",{data:isString(e)?{text:e}:e,parent:this,template:this.template(),textField:t.textField,valueField:t.valueField})},createItem:function(e){var t=this.opts;if(isWidget(e))return e.parent(this);if(Std.is.DOM(e))return e;if(t.template)return this.createTemplateItem(e);var i={ui:t.itemType,parent:this,height:t.itemHeight,iconWidth:t.iconWidth,iconHeight:t.iconHeight};return"block"==t.type&&(i.width=t.itemWidth),isString(e)||isNumber(e)?i.text=e:Std.is.action(e)?i.action=e:isObject(e)&&(i=Std.extend(i,e)),Std.ui(i.ui,i)}},j:{items:function(e,t){return this._items.items(e,t)},type:function(e){return this.opt("type",e,function(){this[1].toggleClass("_block","block"===e)})},editable:function(e){return this.opt("editable",e)},selectedItem:function(){return this._selectedItems[0]||null},selectedItems:function(){return Array.from(this._selectedItems)},itemCount:function(){return this._items.length},itemEditMode:function(e){return this.opt("itemEditMode",e)},itemWidth:function(i){return this.opt("itemWidth",i,function(){this._items.items(function(e,t){t.width(i)})})},itemHeight:function(i){return this.opt("itemHeight",i,function(){this._items.items(function(e,t){t.height(i)})})},sortable:function(e){return this.opt("sortable",e,function(){e&&this.initSortPlugin()})},template:function(e){var t=this.opts;return void 0===e?t.template:((e=isString(e)?Std.template(e):e)instanceof Std.template&&(t.template=e),this)},reload:function(){var i=this,e=i.opts,t=e.dataSource;return t&&t.call("items",{value:e.value},function(e,t){i.clear(),i.append(t)}),i},select:Std.func(function(e){var t,i=this,n=i.opts.selectionMode;"none"!==n&&(isWidget(e)?i.select(i._items.indexOf(e)):(isNumber(e)||isString(e))&&(t=i._items.items(e))&&!i._selectedItems.has(t)&&("single"===n&&i.clearSelected(),i._selectedItems.push(t.addClass("selected")),i.emit("itemSelected",[e,t],!0)))},{each:[isArray]}),prepend:function(e,t,i){return this._items.insert(e,t,0)},insert:function(e,t,i){return this._items.insert(e,t,i)},append:function(e,t){var i=this;return isArray(e)?Std.each(e,function(e,t){return i._items.append(t)},!0):i._items.append(e,t)},clearSelected:function(e){var t,i=this._selectedItems;if(void 0===e){for(var n=0,s=i.length;n<s;n++)i[n].removeClass("selected");i.clear()}else isObject(e)?this.clearSelected(i.indexOf(e)):isNumber(e)&&-1!==e&&(t=i[e])&&i.has(t)&&(t.removeClass("selected"),i.remove(e));return this},clear:function(){var e=this._items;return e.items(function(e,t){t.remove()}),e.clear(),this._selectedItems.clear(),this.emit("clear")},value:function(e){var n=this,t=n.opts,i=null,t=t.valueType;if("list-value"===t)void 0===e?i=n.items(function(e,t){return t.value()},!0):isArray(e)&&Std.each(e,function(e,t){n._items._list[e]?n._items._list[e].value(t):n.append({text:e,value:t})});else if("list-text"===t)void 0===e?i=n.items(function(e,t){return t.text()},!0):isArray(e)&&Std.each(e,function(e,t){n._items._list[e]?n._items._list[e].text(t):n.append(t)});else{if("text-value"!==t)return n.value.parent.call(n,e);void 0===e?(i={},n.items(function(e,t){i[t.text()]=t.value()})):isObject(e)&&Std.each(e,function(i,e){var t=n.items(function(e,t){if(t.text()===i)return t});t?t.value(e):n.append({text:i,value:e})})}return i||n}},k:function(i,e){i._items=Std.items(function(e,t){if(e=i.createItem(e))return isString(t.name)?e.name(t.name):isString(e.name())&&(t.name=e.name()),i[1].insert(e,t.index),i.rendered&&isWidget(e)&&e.render(),e}),i._selectedItems=[],i[1]=newDiv("_items").appendTo(i[0]),i.call_opts({type:"default",template:null,sortable:!1},!0),e.items&&i.append(e.items),i.initEvents(),i.initItemEvents()},m:{rule:{children:"append"},html:{create:function(e){var l=this;e.children(function(e,t){var i=Std.options.get(t),n=t.attr("std-icon"),s=t.attr("std-action"),r=t.attr("std-content");if(r&&"text"!=r){if("data"==r)i=t.html().toObject();else if("widget"==r){r=element.children();if(!(r&&0<r.length))return;var a=r[0].attr("std-ui");return i=isString(a)&&Std.ui(a)?Std.ui.build(r[0],!1):i}}else i.text=t.trimHTML();isString(n)&&(i.icon=n),isString(s)&&(i.action=s),l.append(t.attr("std-name"),i)})}}}});
"undefined;"