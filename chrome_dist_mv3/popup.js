
Std.ui.module("HelpIcon",{parent:"Image",option:{width:16,height:16},main:function(e,t){var o,n={arrow:!1,theme:"black",side:"left-center"};t.text&&(n.html=t.text),t.image&&((o=newDom("img")).attr("src","images/"+t.image+".png"),o.on("load",function(){}),n.html=o),e.src("icons/help.png"),e.plugin("ToolTip",n)}}),Std.dom.behaviorScript["text/init_lang"]=function(){Std.doms('script[type="text/std-ui"]').each(function(e,t){t.text(function(e){for(var t=0,o="",n=0;-1!==(t=e.indexOf("${",t));){if(o+=e.substring(n,t),-1===(n=e.indexOf("}",t))){n=t;break}var i=e.substring(t+2,n);o+=lang(i),t=n,n++}return o+=e.substring(n)}(t.text()))})},chrome.storage.local.get({settings:config.settings,replace_words:config.replace_words},e=>{if(!chrome.runtime.lastError){config.settings=e.settings,config.replace_words=e.replace_words;function n(i,t,e){chrome.tabs.query({currentWindow:!0,active:!0},function(o){function n(e){!chrome.runtime.lastError&&t&&t(e)}"number"==typeof e?chrome.tabs.sendMessage(o[0].id,i,{frameId:e},n):chrome.webNavigation.getAllFrames({tabId:o[0].id},function(e){for(var t of e)chrome.tabs.sendMessage(o[0].id,i,{frameId:t.frameId},n)})})}let o=function(){let t=Std.ui.build("settings");for(let o in t.dataMap){let e=t.dataMap[o];"Button"!==e.ui&&("ToggleBox"===e.ui&&e.on("change",function(e){var t;t=o,config.settings[t]=e,chrome.storage.local.set({settings:config.settings})}),e.value(config.settings[o]))}return t.dataMap.auto_click.on("click",function(){n({type:"auto_click",from_popup:!0}),this.enable(!1)}),t.data[0]};function i(){var t=!!this.checked&&this.checked();s.clearRows(),chrome.tabs.query({active:!0,currentWindow:!0},function(e){e=new URL(e[0].url);function o(t){for(let e=0;e<t.length;++e){var o=t[e];s.appendRow({cells:[o.host,o.selector,o.path,lang(o.once?"yes":"no"),lang(o.loop?"yes":"no"),o.interval,o.total]})}}chrome.runtime.sendMessage({type:"query_auto_clicks",host:t?null:e.host},function(e){if(e instanceof Array)o(e);else if("object"==typeof e)for(var t in e)o(e[t])})})}var a=Std.ui("ToolBar",{items:[{text:lang("add"),icon:"icons/add.png",click:function(){let o=Std.ui.build("replace_words_add");let n=Std.ui("Window",{title:lang("add"),width:300,height:132,layout:o.data[0],toolBar:{iconWidth:24,iconHeight:24,items:[{text:lang("save"),icon:"icons/save.png",click:function(){var e=o.dataMap.origin.value().trim(),t=o.dataMap.replaced.value().trim();e!==t&&(l.appendRow({cells:[e,t]}),config.replace_words[e]=t,chrome.storage.local.set({replace_words:config.replace_words}),n.close())}}]}});return o.data[0]}},{text:lang("remove"),icon:"icons/remove.png",click:function(){l.removeRow(l.selectedRows());let t={};for(let e=0;e<l.rowCount();++e){var o=l.row(e).cells;t[o[0]]=o[1]}chrome.storage.local.set({replace_words:config.replace_words=t})}}]}),l=Std.ui("Grid",{cellEditable:!1,rowNumbers:!0,columnDroppable:!0,columnResizable:!0,columnSortable:!0,stripeRows:!0,rowResizable:!0,selectionMode:"rows",hoverMode:"cell",valueType:"map",columns:[{name:"origin",text:lang("origin"),width:160},{name:"replaced",text:lang("replaced"),width:160}]}),c=Std.ui("ToolBar",{iconWidth:16,iconHeight:16,items:[{text:lang("remove"),icon:"icons/remove.png",click:function(){var t=[],o=s.selectedRows();for(let e=0;e<o.length;++e){var n=s.row(o[e]).cells;t.push({host:n[0],selector:n[1],path:n[2]})}0<t.length&&(s.removeRow(o),chrome.runtime.sendMessage({type:"remove_auto_clicks",items:t},function(e){}))}},{ui:"sep"},{text:lang("copy"),icon:"icons/copy.png",click:function(){function e(e){o+=JSON.stringify({host:s.cell(e,0),selector:s.cell(e,1),path:s.cell(e,2),once:s.cell(e,3)===lang("yes"),loop:s.cell(e,4)===lang("yes"),interval:s.cell(e,5),total:s.cell(e,6)})+"\r\n"}var t=s.selectedRows(),o="";if(0===t.length)for(var n=0;n<s.rowCount();++n)e(n);else for(n=0;n<t.length;++n)e(t[n]);copy_to_clipboard(0!==o.length?o:"")}},{text:lang("paste"),icon:"icons/paste.png",click:function(){var n=[];Std.ui("MessageBox",{title:lang("paste"),text:lang("paste"),inputType:"TextEdit",inputWidth:280,inputHeight:100,on:{ok:function(){for(var e=this.value().trim().split("\n"),t=0;t<e.length;++t)try{var o=JSON.parse(e[t]=e[t].trim());"object"==typeof o&&o.host&&o.path&&"string"==typeof o.selector&&n.push(o)}catch(e){console.log(e)}0!==n.length&&(chrome.runtime.sendMessage({type:"add_auto_clicks",values:n}),Std.ui("Notify").success({title:lang("paste"),theme:"white",text:"OK",timeout:"2s"}))}}})}},{ui:"sep"},{text:lang("show_all"),checkable:!0,icon:"icons/links.png",click:i}]}),s=Std.ui("Grid",{cellEditable:!1,rowNumbers:!0,columnDroppable:!0,columnResizable:!0,columnSortable:!0,stripeRows:!0,rowResizable:!0,selectionMode:"rows",hoverMode:"cell",valueType:"map",columns:[{name:"host",text:lang("host"),width:120},{name:"selector",text:"CSS "+lang("selector"),width:180},{name:"path",text:lang("path"),width:160},{name:"once",text:lang("once"),width:80},{name:"loop",text:lang("loop"),width:80},{name:"interval",text:lang("interval"),width:80},{name:"total",text:lang("total"),width:80}]});Std.main(function(){var e,t=Std.ui("TabPanel",{items:[{button:{text:lang("settings"),icon:"icons/settings.png",iconWidth:16,iconHeight:16,styleType:"textBesideIcon"},content:{layout:o()}},{button:{text:lang("auto_clicks"),icon:"icons/cursor.png",iconWidth:16,iconHeight:16,styleType:"textBesideIcon"},content:{layout:{ui:"VBoxLayout",items:[c,s]}}},{button:{text:lang("replace_words"),icon:"icons/text.png",iconWidth:16,iconHeight:16,styleType:"textBesideIcon"},content:{layout:{ui:"VBoxLayout",items:[a,l]}}}]});Std.ui("widget",{width:420,height:420,renderTo:"body",layout:{ui:"VBoxLayout",items:[t]}});for(e in i(),config.replace_words)l.appendRow({cells:[e,config.replace_words[e]]})})}});