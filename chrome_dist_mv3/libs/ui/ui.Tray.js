
Std.ui.module("TrayItem",{b:"widget",e:{tabIndex:null,defaultClass:"StdUI_TrayItem",icon:"",name:"",text:"",popup:null,contextMenu:null},g:{destroy:function(){var t=this.opts;isWidget(t.contextMenu)&&t.contextMenu.remove()}},j:{name:function(t){return this.opt("title",t,function(){this._tooltipTitle&&this._tooltipTitle.html(t)})},text:function(t){return this.opt("text",t,function(){this._tooltipText&&this._tooltipText.html(t)})},icon:function(t){var i=this;return i.opt("icon",t,function(){i[1].attr("src",t),i._tooltipIcon&&i._tooltipIcon.attr("img",t)})},popup:function(t){var i=this.opts;return void 0===t?i.popup:(!isWidget(t)&&isObject(t)?i.popup=Std.ui(t.ui||"widget",t):i.popup=t,this)},contextMenu:function(t){var i=this.opts;return void 0===t?i.contextMenu:(!isWidget(t)&&isObject(t)&&(t=Std.ui(t.ui||"Menu",t)),isWidget(t)&&t.on("itemPress",function(){t.hide()}),i.contextMenu=t,this)}},k:function(t,i){t[0].append(t[1]=newDom("img")),t.call_opts({icon:"",name:"",text:"",popup:null,contextMenu:null},!0)},m:{rule:{content:"text"},html:{create:function(t){var i=t.attr("title"),e=t.attr("std-icon"),t=t.trimHTML();isString(i)&&this.text(i),isString(e)&&this.icon(e),isEmpty(t)||this.text(t)}}}}),Std.ui.module("Tray",{b:"widget",c:"itemClick",e:{level:3,spacing:4,iconSize:22,defaultClass:"StdUI_Tray",value:null,tabIndex:null},h:{timer:null,state:!1,iconViewInitialized:!1,iconViewVisibled:!1,contextMenu:null},g:{beforeRender:function(){},height:function(){this.updateHeight()},render:function(){var t=this;t.update(),t.initEvents(),t.initDocEvents()},destroy:function(){var t=this;t._popup&&t._popup.remove(),t._tooltip&&t._tooltip.remove(),t._docEvent&&Std.dom(document).off("mousedown",t._docEvent),t[3]&&t[3].remove(),Std.each(t._items,function(t,i){i.remove()})},remove:function(t){var i=this,e=i._items;isNumber(t)?t<e.length&&(e[t].remove(),e.remove(t),i.update()):isWidget(t)&&-1!==(t=e.indexOf(t))&&(e[t].remove(),e.remove(t),i.update())}},i:{initDocEvents:function(){var e=this;Std.dom(document).on("mousedown",e._docEvent=function(t){var i=t.target;if(!(e._contextMenu&&e._contextMenu[0].contains(t.target)||(e.hideContextMenu(),e[0].contains(i)||e[3]&&e[3].contains(i)))){if(e._popup){if(e._popup.contains(i))return;e.hidePopup()}!e._tooltip||e._tooltip.contains(i)||e.hideToolTip()}})},createPopup:function(){var t=this;return t._popup&&t._popup.remove(),t._popup=newDiv("Tray_Popup").append([t._popupTitle=newDiv("_title"),t._popupMain=newDiv("_main")]).appendTo("body"),t},createToolTip:function(){var t=this,i=1.5*t.opts.iconSize;return t._tooltip&&t._tooltip.remove(),t._tooltip=newDiv("Tray_ToolTip").append([t._tooltipIcon=newDom("img","_icon").height(i).width(i),newDiv("_main").append([t._tooltipTitle=newDiv("_title"),t._tooltipText=newDiv("_text")])]).appendTo("body"),t},trayItemEvents:function(i,t){var e=this;clearTimeout(e._timer),!1===e._state?(e._state=!0,e._timer=setTimeout(function(){e.showToolTip(i)},800)):e.showToolTip(i),i[0].mouse({auto:!1,leave:function(){clearTimeout(e._timer),e._timer=setTimeout(function(){e.hideToolTip()},100)},down:function(){e._state=!1,clearTimeout(e._timer)},click:function(t){i.opts.popup?e.showPopup(i):e._popup&&e._popup.visible()&&e.hidePopup(),e.emit("itemClick",[t,i],!0)}},t)},initEvents:function(){var i=this;return i[0].on("mouseleave",function(){i._state=!1}).on("contextmenu",function(t){t.preventDefault()}).on("mouseenter",">.StdUI_TrayItem",function(t){return i.trayItemEvents(this.ui(),t)}).on("contextmenu",".StdUI_TrayItem",function(t){i.showContextMenu(this.ui(),t)}),i[2].on("click",function(t){i._iconViewVisibled?i.hideIconView():i.showIconView()}),i},initIconView:function(){var i=this;return i._iconViewInitialized||(i[3]=newDiv("StdUI_Tray-iconView").appendTo("body"),i._iconViewInitialized=!0),i[3].on("mouseleave",function(){i._state=!1}).on("contextmenu",function(t){t.preventDefault()}).on("mouseenter",">.StdUI_TrayItem",function(t){return i.trayItemEvents(this.ui(),t)}).on("contextmenu",".StdUI_TrayItem",function(t){i.showContextMenu(this.ui(),t)}),i},updateHeight:function(){var t=this,i=t.height()-t.boxSize.height-t.boxSize.extraHeight;return t[2].marginTop((i-t[2].height())/2),t},update:function(){var e=this,o=e.opts,t=e.width()-e.boxSize.width-e.boxSize.extraWidth,i=e.height()-e.boxSize.height-e.boxSize.extraHeight,n=e.iconSize(),p=Math.floor(i/(n+4)),u=Math.floor(t/(n+4)),s=0;return e._items.length<=u*p?(e[2].hide(),e[1].removeStyle("width")):(e[2].show(),u=Math.floor((t-=e[2].width())/(n+4)),e[1].width(t)),Std.each(e._items,function(t,i){if(u*p<=t)return e._iconViewInitialized||e.initIconView(),void i[0].css("marginRight",o.spacing).appendTo(e[3]);t+1%u===0&&s++,0<s&&s<p&&i[0].css("marginBottom",o.spacing),i[0].show().css("marginRight",o.spacing),i.appendTo(e[1]),i.rendered||i.render()}),e[1].css("marginTop",(i-e[1].height())/2),e.updateIconViewHeight()},updateIconViewHeight:function(){var t,i,e=this;e[3]&&e[3].visible()&&(t=e[0].offset(),i=e[3].removeStyle("height").outerHeight(),0==e[3].height()?e.hideIconView():e[3].animate("end").animate({to:{top:t.y-i,outerHeight:i}},100))}},j:{showPopup:function(t){var i=this,e=i[0].offset(),o=t.popup(),o=(i._popup||i.createPopup(),isWidget(o)?(i._popupMain.clear(),i._popupMain.append(o),o.rendered||o.render()):(isString(o)||isNumber(o))&&i._popupMain.html(o),i._popupTitle.html(t.name()),i._popup.show(),e.x+(i.width()-i._popup.outerWidth())/2),t=e.y-i._popup.offsetHeight()-5;return o<0?o=0:o+i._popup.offsetWidth()>Std.dom(window).width()&&(o=Std.dom(window).width()-i._popup.offsetWidth()),i._popup.css({top:t,left:o,zIndex:++Std.ui.status.zIndex}),i.hideToolTip().hideIconView()},hidePopup:function(){return this._popup&&this._popup.hide(),this},updateToolTip:function(t,i,e){return this._tooltipIcon.attr("src",t),this._tooltipTitle.html(i),this._tooltipText.html(e),this},showToolTip:function(t){var i=this,e=t[0].offset(),o=t.icon(),n=t.name(),p=t.text(),o=(i._tooltip?(i.updateToolTip(o,n,p),i._tooltip.show()):(i.createToolTip(),i.updateToolTip(o,n,p),i._tooltip.css({top:e.y-i._tooltip.offsetHeight()-5,left:0,visibility:"hidden"})),e.x-(i._tooltip.offsetWidth()-t.width())/2),n=e.y-i._tooltip.offsetHeight()-5;return o<0?o=0:o+i._tooltip.offsetWidth()>Std.dom(window).width()&&(o=Std.dom(window).width()-i._tooltip.offsetWidth()),n<0&&(n=e.y+i.height()),"hidden"===i._tooltip.css("visibility")&&i._tooltip.removeStyle("visibility").css("left",o),i._tooltip.css("zIndex",++Std.ui.status.zIndex).animate("end").animate({to:{top:n,left:o}},100),i},hideToolTip:function(){return this._tooltip&&this._tooltip.hide(),this},showIconView:function(){var t=this,i=t[0].offset(),e=(t._iconViewInitialized||t.initIconView(),Std.each(t._items,function(t,i){i.rendered||i.render()}),t[3].removeStyle("height").show().css({outerWidth:t.width(),top:i.y-t[3].boxSize().height,left:i.x}),t[3].outerHeight());return t[2].addClass("_visibled"),t[3].height(0).animate("end").animate({to:{top:i.y-e,outerHeight:e}},100),t._iconViewVisibled=!0,t.hidePopup()},hideIconView:function(){var t=this;return t[2]&&t[3]&&(t[2].removeClass("_visibled"),t[3].animate("end").animate({to:{top:t[0].offset().y-t[3].boxSize().height,height:0}},100,function(){t[3].hide()}),t._iconViewVisibled=!1),t},showContextMenu:function(t,i){var e,o,t=t.contextMenu();t&&(t.rendered||(t[0].css("position","absolute"),t.renderTo("body")),t.show(),e=i.pageX,o=i.pageY-t.height(),e+t.width()>Std.dom(window).width()&&(e=Std.dom(window).width()-t.width()),o<0&&(o=i.pageY),this._contextMenu=t.move(e,o),this.hideToolTip())},hideContextMenu:function(){return this._contextMenu&&this._contextMenu.hide(),this},iconSize:function(e){var o=this;return o.opt("iconSize",e,function(){Std.each(o._items,function(t,i){o[2].height(e).width(e),i.width(e).height(e)}),o.updateHeight()})},add:function(t){var t=Std.ui("TrayItem",t),i=this.iconSize();return t.parent(this).width(i).height(i),this._items.push(t),this.rendered&&t.render(),t},append:Std.func(function(t){this.add(t);this.rendered&&this.update()},{each:[isArray]})},k:function(t,i,e){t._items=[],e.append([t[2]=newDiv("_handle").css({width:i.iconSize,height:i.iconSize}),t[1]=newDiv("_icons")]),i.items&&t.append(i.items)},m:{rule:{children:"append"},html:{create:function(t){this.append(t.children(function(t,i){var e={},o=i.attr("title"),n=i.attr("std-icon"),p=i.html().trim();return isString(o)&&(e.text=o),isString(n)&&(e.icon=o),isEmpty(p)||(e.text=o),Std.extend(e,Std.options.get(i),3)}))}}}});
"undefined;"