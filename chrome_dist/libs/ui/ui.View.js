
Std.ui.module("View",{parent:"widget",events:"itemResizeStart itemResizeStop itemDropStart itemDragStop itemDropStop itemSelected itemRemove clearSelected receive",option:{level:4,defaultClass:"StdUI_View",dots:!1,editable:!0,valueType:"config",background:null,selectionClass:"",itemContextMenu:null,layoutType:"AbsLayout",itemResizable:!0,itemDraggable:!0,itemDroppable:!0,selectable:!0,padding:2},private:{itemZIndex:0,hasEventBlock:!1,currentItem:null,currentLocker:null,receiving:!1,blockedEvents:"mousedown mouseup mouseover mouseout mouseenter mouseleave click dblclick contextmenu"},initialize:{initDOMTree:function(){var e=this,t=e.opts,n=(e.DOMMap={},{type:e.opts.layoutType,className:"_client",width:null,height:null,initSize:!1,initBoxSize:!1,appendTo:e[0]});t.spacing&&(n.spacing=t.spacing),e._client=Std.ui("layoutWidget",n),t.editable||e._client.addClass("_preview")},initLocker:function(){var e=this;e.DOMMap.locker=newDiv("_locker").appendTo(e[0]),e[0].on({mouseenter:function(){Std.ui.status.lock||e._receiving||e.receiving(!0)},mouseleave:function(){!Std.ui.status.lock&&e._receiving&&e.receiving(!1)}})},initItemContextMenu:function(e){var t=this,n=null;isArray(e)?n={items:e}:isPlainObject(e)?n=e:isObject(e)&&(n={menu:e}),isObject(n)&&(n.cancel=null,n.check=function(){return t.enable()&&t.editable()}),t._client.plugin("contextMenu",n)},initKeyEvents:function(){var i=this;i[0].on("keydown[del]",function(){if(i.editable()&&i.enable())for(var e=i._selectedItems.length-1;0<=e;e--)i.remove(i._selectedItems[e])}),i[0].on("keydown[Ctrl+A]",function(e){if(i.editable()&&i.enable()){for(var t=0,n=i.itemCount();t<n;t++)i.select(t);e.preventDefault()}}),i[0].on("keydown",function(e){var n=e.which;i.editable()&&i.enable()&&37<=n&&n<=40&&Std.each(i._selectedItems,function(e,t){"AbsLayout"===t.parent().ui&&(38===n?t[0].css("top","-",1):39===n?t[0].css("left","+",1):40===n?t[0].css("top","+",1):37===n&&t[0].css("left","-",1))})})},initResizeEvents:function(){var n=this,i=n.opts;n._client.plugin("resize",{items:".StdUI_LayoutItem",handle:".StdUI_LayoutItem > .StdUI_View_ResizeHandle",helper:"original",opacity:1,check:function(e){var e=e.ui(),t=e.item();return!!(i.editable&&i.enable&&i.itemResizable)&&(!(!isWidget(t)||"spacing"!==t.ui)||"AbsLayout"==e.parent().ui&&void 0)}}).on({start:function(e){n.emit("itemResizeStart",[e.self.ui(),e],!0)},stop:function(e){var t=e.self.ui();t.size(e.width,e.height),n.update(),n.emit("itemResizeStop",[t,e],!0)},move:function(e){var e=e.self.ui(),t=e.item(),n=Math.max(e[0].width(),e.minWidth()),i=Math.max(e[0].height(),e.minHeight());e.size(n,i),isObject(t.opts)&&(t.opts.width=n,t.opts.height=i),"layout"===e.type()&&e.item().update()}})},initDropEvents:function(){var n=this,t=n.opts;n._client.plugin("drop",{items:".StdUI_LayoutItem",placeHolder:"sep",helper:"clone",draggable:!0,originalHelperVisible:!1,activeClass:"StdUI_View_AllowDrop",cancel:null,check:function(e){return(t.itemDroppable||t.itemDraggable)&&t.editable&&t.enable&&n.queryContainer(e)},accept:function(e){return t.editable&&t.enable&&n.queryContainer(e)}}).on({mousedown:function(){this.droppable(t.itemDroppable),this.draggable(t.itemDraggable)},start:function(e){var t=e.self.ui();n.emit("itemDropStart",[t,e],!0),this.orientation(t.parent().orientation)},drag:function(e){var t=e.self.ui();(e.cancel="AbsLayout"!==t.parent().ui||!e.containment)||(t.left(e.positionX),t.top(e.positionY),n.emit("itemDragStop",[t,e],!0))},enter:function(e){n.dropEnter(this,e)}}).on("sort drop",function(e){var t=e.self.ui(),t=(t.parent().remove(t,!1).update(),n.put(t,n.queryContainmentLayout(e.containment),e.index,e.positionX,e.positionY));n.update(),n.emit("itemDropStop",[t,e],!0)})},initClientEvents:function(){var n=this,i=n.opts;n._client[0].on("contextmenu",function(e){i.editable&&i.enable&&e.preventDefault()}),n._client[0].on("mousedown",function(e){n[0].focus()&&n._client[0].is(e.target)&&n.clearSelected()}),n._client[0].on("mousedown",".StdUI_LayoutItem",function(e){var t=this.ui();i.editable&&i.enable&&n.queryContainer(t)&&(e.ctrlKey?t.selected?n.clearSelected(t):n.select(t):(n.clearSelected(),n.select(t)),e.preventDefault())})},initSelection:function(){var t=this,n=t.DOMMap,i=0,o=0,l=null,e=n.selection=newDiv("_selection "+t.opts.selectionClass),a=function(){Std.css.cursor(null),Std.dom(document).off({mouseup:a,mousemove:c}),t.selectRange(e.css("left"),e.css("top"),e.width(),e.height()),n.selection.detach()},c=function(e){var t=e.pageX-l.x,e=e.pageY-l.y;n.selection.css({left:t<i?t:i,top:e<o?e:o,width:Math.abs(t-i),height:Math.abs(e-o)})};t[0].on("mousedown[1]",function(e){t._client[0].is(e.target)&&t.selectable()&&t.editable()&&t.enable()&&!Std.ui.status.lock&&(l=t._client[0].offset(),n.selection.appendTo(t[0]).css({left:i=e.pageX-l.x,top:o=e.pageY-l.y,width:0,height:0,zIndex:Std.ui.status.zIndex+1}),Std.css.cursor("default"),Std.dom(document).on({mouseup:a,mousemove:c}))})}},extend:{render:function(){var e=this,t=e.opts;e.initClientEvents(),e.initKeyEvents(),e.initLocker(),e._client.render(),e[0].unselect(!0).on("blur",function(){e.clearSelected()}),t.itemResizable&&e.initResizeEvents(),(t.itemDroppable||t.itemDraggable)&&e.initDropEvents(),t.selectable&&e.initSelection(),t.value&&e.value(t.value),t.itemContextMenu&&e.initItemContextMenu(t.itemContextMenu),e.updateHelpers()},width:function(){this.rendered&&this._client.update()},height:function(){this.rendered&&this._client.update()},enable:function(n){this.items(function(e,t){t.enable(n)})},remove:function(e){var t=null;void 0!==e&&(isNumber(e)?t=this.items(e):isObject(e)&&(e=(t=e).parent()._items.indexOf(e)),t&&isNumber(e)&&-1<e&&(this.clearSelected(t),this.emit("itemRemove",t),t.parent().remove(e),this._client.update()))},destroy:function(){this.clearEventBlock(),this._client.destroy(),this._selectedItems.clear(),this._currentItem=null}},protected:{createEventBlock:function(){var n=this;n._hasEventBlock||(Std.each(n._blockedEvents,function(e,t){Std.dom.addEventBlock(t,n._eventBlock)}),n._hasEventBlock=!0)},createLayoutHandle:function(e){for(var t=[],n=[{top:-2,left:0,width:"100%"},{right:-2,top:0,height:"100%"},{bottom:-2,left:0,width:"100%"},{left:-2,top:0,height:"100%"}],i=0;i<4;i++)Std.dom(e).append(t[i]=newDiv("StdUI_View_LayoutHandle").css(n[i]));return t},createItemHandles:function(e){this.clearItemHandles(e);for(var o=[],t=0;t<8;t++)Std.dom(e).append(o[t]=newDiv("StdUI_View_ResizeHandle"));return Std.each({"0 6 7":{left:-4},"2 3 4":{right:-4},"0 1 2":{top:-4},"4 5 6":{bottom:-4},"1 5":{left:"50%",marginLeft:-3},"3 7":{top:"50%",marginTop:-3}},function(e,t){for(var n=0,i=(e=e.split(" ")).length;n<i;n++)Std.dom(o[e[n]]).css(t)}),o},queryContainmentLayout:function(e){var t=e.ui();return t?"layoutItem"===t.ui?t.item():t.layout():e.layout()},queryContainer:function(e){var t=this._client[0],n=null,i=null,o=".StdUI_LayoutItem";if(!t.contains(e))return null;if(t.is(e=Std.dom(e)))return t;if(e.is(o)){if("layout"===(n=e).ui().type())return n}else{if(i=this.queryContainmentLayout(e))return Std.dom(i.parent());n=Std.dom(e).parent(o)}if(n){if(t.is(i=n.ui().parent()))return t;if(i&&isLayout(i))return Std.dom(i.parent())}return null},dropEnter:function(e,t){var n="",t=t.containment,i=null;(i=t.is(this._client)?this._client.layout():this.queryContainmentLayout(t))&&(n=i.orientation,e.sortable("AbsLayout"!==i.ui)),n&&e.orientation(n)},receive:function(e,t){var n=this;Std.dom(e).plugin("drop",Std.extend({placeHolder:"sep",activeClass:"StdUI_View_AllowDrop",containerItems:".StdUI_LayoutItem",cancel:null,accept:function(e){return n.editable()&&n.enable()&&n.queryContainer(e)}},t)).on("drop sort",function(e){e.layoutIndex="sort"===e.name?e.item.ui().index()+("after"===e.side?1:0):-1,e.contaimmentLayout=n.queryContainmentLayout(e.containment),n.emit("receive",e),n.updateHelpers(),n.update()}).on({start:function(){n.receiving(!0),this.orientation(n._client.layout().orientation)},enter:function(e){n.dropEnter(this,e)}})},updateHelpers:function(){var t=this,n="StdUI_View_Layout";return t._client[0].find(".StdUI_Layout:not('."+n+"')",function(e){e=e.addClass(n).ui();e&&"layoutItem"===e.ui&&t.createLayoutHandle(e)}),t},clearItemHandles:function(e){var t=e._handles;return t&&(Std.each(t,function(e,t){t.remove()}),delete e._handles),this},clearEventBlock:function(){var n=this._eventBlock;n&&this._hasEventBlock&&(Std.each(this._blockedEvents,function(e,t){Std.dom.removeEventBlock(t,n)}),this._hasEventBlock=!1)}},public:{update:function(){return this._client.update(),this},receiving:function(e){var t=this,n=t.DOMMap;return void 0===e?t._receiving:(!0===e?(n.locker.detach(),t.editable()&&t.enable()&&t.createEventBlock()):(n.locker.appendTo(t[0]),t.clearEventBlock()),t._receiving=e,t)},currentItem:function(){return this._currentItem||this.selectedItem()},items:function(e,t){return this._client.layoutItems(e,t)},itemCount:function(){return this._client.itemCount()},itemResizable:function(e){return this.opt("itemResizable",e,function(){e&&this.initResizeEvents()})},itemDraggable:function(e){return this.opt("itemDraggable",e,function(){e&&this.initDropEvents()})},itemDroppable:function(e){return this.opt("itemDroppable",e,function(){e&&this.initDropEvents()})},selectable:function(e){return this.opt("selectable",e,function(){e&&this.initSelection()})},editable:function(e){var t=this;return t.opt("editable",e,function(){e||(t.clearSelected(),t.clearEventBlock()),t._client.toggleClass("_preview",!e)})},dots:function(e){return this.opt("dots",e,function(){this._client[0].toggleClass("_dots")})},itemContextMenu:function(e){return this.opt("itemContextMenu",e,function(){this.initItemContextMenu(e)})},background:function(e){var t=this;return t.opt("background",e,function(){t[0].css("background",null===e?"":e)})},selectedItem:function(){return this._selectedItems[0]||null},selectedItems:function(){return Array.from(this._selectedItems)},layoutType:function(e){return this.opt("layoutType",e,function(){this._client.toggleLayout(e)})},insert:function(e,t,n){return!1!==this._client.insert(e,t,n)&&(this._client.update(),this.updateHelpers())},append:function(e){var n=this._client;return isArray(e)?Std.each(e,function(e,t){n.append(t)}):n.append(e),n.update(),this.updateHelpers()},put:function(e,t,n,i,o){var e=t.insert(e,n),n=e.item(),l=e.type();return"AbsLayout"===t.ui?(e.left(i),e.top(o)):"layout"===l&&(n.opts.width="auto",n.opts.height="auto"),t.update(),this.updateHelpers(),e},replace:function(e,t){},select:function(e){var t=this,n=null,i=t._selectedItems;return!(n=isObject(e)?e:t._client.layoutItems(e))||n._selected?t:(n._selected=!0,n._handles=t.createItemHandles(n),n.addClass("StdUI_View_SelectedItem"),i.push(n),Std.dom(t._currentItem=n).css("zIndex",++this._itemZIndex),t.emit("itemSelected",[n,!0],!0))},selectRange:function(a,c,r,s){function u(e,t,n,i){return n<=e&&e<=i||n<=t&&t<=i||e<=n&&i<=t}var d=this;d._client.layoutItems(function(e,t){var n=t.left(),i=t.top(),o=t.width(),l=t.height();u(c,c+s,i,i+l)&&u(a,a+r,n,n+o)&&d.select(t)})},clearSelected:function(e){var t=this,n=t._selectedItems;if(void 0===e){for(var i=n.length-1;0<=i;i--)t.clearSelected(n[i]);t.emit("clearSelected")}else t._currentItem===e&&(t._currentItem=null),t.clearItemHandles(e),e._selected=!1,e.removeClass("StdUI_View_SelectedItem"),n.remove(n.indexOf(e));return t},html:function(e){},config:function(e){},value:function(e){this.opts.valueType},clear:function(){return this.clearSelected(),this._client.clear(),this._currentItem=null,this}},main:function(t,e){t._selectedItems=[],t._eventBlock=function(e){if(t._client[0].contains(this)&&this.not(t._client)&&(this.not(".StdUI_View_ResizeHandle")||this.not(".StdUI_LayoutItem")))return!1},t.initDOMTree(),e.dots&&t.dots(!0),e.background&&t.background(e.background),e.items&&t.append(e.items)},m:{rule:{content:"html",children:function(e){}},html:{nodeName:["DIV"],create:function(e){}}}});
"undefined;"