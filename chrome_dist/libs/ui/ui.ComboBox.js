
Std.ui.module("ComboBoxItem",{b:"Item",e:{defaultClass:"StdUI_ComboBoxItem"}}),Std.ui.module("ComboBox",{b:"widget",e:{level:3,defaultClass:"StdUI_ComboBox",minWidth:40,minHeight:20,listMaxHeight:300,listAnimation:!0,items:null,value:null,template:null,editable:!1,valueType:"text",textField:"text",valueField:"value",dataSource:null,suggest:!1},c:"open close select input change focus blur dataSourceMessage",h:{listVisible:!1,currentMode:"",currentFilterItems:null,currentItem:null,selectedItem:null},n:{initHandle:function(){var t=this.DOMMap;null==t.handle&&(t.handle=newDiv("_handle").appendTo(this[0]))},initDataSource:function(){var i=this,t=i.opts;i.dataSource=Std.dataSource(t.dataSource),i.dataSource.on("message",function(t){i.emit("dataSourceMessage",t)}).call("items",{value:t.value},function(t,e){i.append(e),i.call_opts("value",!0)})},initKeyboard:function(){var s=this;s.on("keydown",function(t){var e=s._items,i=e.indexOf(s._currentItem),n=t.which,t=t.keyCode;27===n?s.close():32!==n||s.editable()||s.open(),-1!=i&&(38===t?(s.value(--i<0?e._list[e.length-1]:e._list[i]),s.focus()):40===t&&(s.value(++i>=e.length?e._list[0]:e._list[i]),s.focus()))})},initEvents:function(){var e=this,i=!1;e[0].on({mousedown:function(t){1===t.which&&"INPUT"!==t.target.nodeName&&e.toggleList()},focusin:function(t){e.addClass("focused").emit("focus",t),!1===i&&(e.initKeyboard(),e.on("focusout",function(t){e.emit("blur",t)[0].removeClass("focused")}),e.DOMMap.input&&e.DOMMap.input.focus().on("change",function(){e.emit("change",e.value())}),i=!0)}}).mouse({unselect:!0})},initList:function(){var i=this,n=i.DOMMap;void 0===n.list&&(n.list=newDiv("StdUI StdUI_ComboBoxList").on("mousedown",function(t){return!1}).delegate("mouseenter",".StdUI_ComboBoxItem,.StdUI_TemplateItem",function(t){i.itemMouseEnter(this,t)}),i._items.items(function(t,e){e.appendTo(n.list),i._listVisible&&e.render()}))}},g:{render:function(){var t=this,e=t.opts;t.initEvents(),t.call_opts({value:null},!0),e.dataSource&&t.initDataSource()},enable:function(t){var e=this.DOMMap.input,i="disabled";!1===t?e&&e.attr(i,i):e&&e.removeAttr(i)},height:function(t){var e=this,i=e.DOMMap;"auto"!==t&&(isNumber(t)||(t=e.height()),t-=e.boxSize.height+e.boxSize.extraHeight,i.input&&i.input.css({height:t,lineHeight:t}),i.content&&i.content.css({height:t,lineHeight:t}),(t-24)/2!=0&&i.handle.marginTop((t-24)/2))},width:function(t){var e=this,i=e.DOMMap;"auto"!==t&&(t=e.width()-e.boxSize.width-e.boxSize.extraWidth,i.input&&i.input.css({width:t-24}),i.content&&i.content.css({width:t-24}))},destroy:function(){var t=this;t._currentFilterItems&&(t._currentFilterItems=null),t.clear(),t.DOMMap.list&&t.DOMMap.list.remove(),t.delDocumentEvents()},remove:function(t){var e=null;(isString(t)||isNumber(t))&&(e=this._items.items(t))&&(e.remove(),this._items.remove(t))}},i:{createItem:function(t){var e=this,i=e.opts,n=null;return isString(t)||isNumber(t)?n=Std.ui("ComboBoxItem",{text:t,parent:e}):isWidget(t)?n=t.parent(e):isObject(t)&&(n=i.template?Std.ui("TemplateItem",{template:e.template(),data:t,parent:e,textField:i.textField,valueField:i.valueField}).render():Std.ui(t.ui||"ComboBoxItem",t).parent(e)),n},toggleList:function(){var t=this,e=t.DOMMap;if(t.enable())return 1==t._listVisible?t.close():(t.opts.suggest&&e.input&&t.filterList(e.input.value()),t.open()),t},itemMouseEnter:function(t,e){var i=this,n=t.index(),s=null,s=(isEmpty(i._currentFilterItems)?i._items._list:i._currentFilterItems)[n];return t.mouse({auto:!1,classStatus:!1,enter:function(){i._selectedItem&&i._selectedItem.removeClass("selected"),i._selectedItem=s.addClass("selected")},click:function(t){i.value(s),i.toggleList(),i.focus()}},e),i},addDocumentEvents:function(){var e=this,i=e.DOMMap;return e._documentEvents&&Std.dom(document).off("mousedown",e._documentEvents),Std.dom(document).on("mousedown",e._documentEvents=function(t){i.list&&i.list.contains(t.target)||e.delDocumentEvents().close()}),e},delDocumentEvents:function(){return this._documentEvents&&(Std.dom(document).off("mousedown",this._documentEvents),this._documentEvents=null),this},initInput:function(){var e=this,i=e.opts,n="";return e.DOMMap.input.on("input keyup",function(){var t=this.value();i.suggest&&t!==n&&(""===t||isEmpty(e.filterList(t))?e.close():e.open()),e.emit("input",n=t)}).on("dblclick",function(){!i.suggest||e._listVisible||isEmpty(e.filterList(this.value()))||e.open(!1)}),e}},j:{textField:function(t){return this.opt("textField",t)},valueField:function(t){return this.opt("valueField",t)},items:function(t,e){return this._items.items(t,e)},text:function(t){var e=this.DOMMap;return void 0===t?e.content.text():(e.content.text(t),this)},select:function(t,e){var i=this;return(isNumber(t)||isString(t))&&(t=i._items.items(t)),isWidget(t)&&i._currentItem!==t&&(i._currentItem&&i._currentItem.removeClass("selected"),i._currentItem=i._selectedItem=t.addClass("selected"),!1!==e&&(i.emit("select",t),i.emit("change",i.value()))),i},template:function(t){var e=this.opts;return void 0===t?e.template:((t=isString(t)?Std.template(t):t)instanceof Std.template&&(e.template=t),this)},value:function(t,e){var i=this[this.opts.valueType+"Value"];return isFunction(i)?i.call(this,t,e):void 0===t?null:this},reload:function(){var e=this,t=e.opts,i=e.dataSource;return i&&i.call("items",{value:t.value},function(t){e.clear(),e.append(t),e.call_opts("value",!0)}),e},editable:function(t){var e=this,i=e.DOMMap;return e.opt("editable",t,function(){i.input&&i.input.remove(),i.content&&i.content.remove(),""!==e._currentMode&&e.removeClass("_"+e._currentMode),!0===t?(i.input=newDom(e._currentMode="input","_input").appendTo(e[0]),e.initInput()):(e._currentMode="none",i.content=newDiv("_content").appendTo(e[0])),e.addClass("_"+e._currentMode)})},textValue:function(t,e){var i=t,n=this.DOMMap;if(!0===this.editable()){if(void 0===t)return n.input.value();isWidget(t)&&(i=t.text()),n.input&&n.input.value(i)}else{if(void 0===t)return this.text();isWidget(t)&&(i="TemplateItem"===t.ui?t.text():t[0].clone().className(t.opts.defaultClass)),n.content&&n.content.html(i)}return this.select(t,e)},indexValue:function(t,e){var i=this,n=null,s=t,l=i.DOMMap,o=i.editable();if(i.DOMMap.list||i.initList(),void 0===t)return i._currentItem?i._items.indexOf(i._currentItem):null;if(isWidget(t)){if(-1===(s=i._items.indexOf(t)))return i}else isString(s)&&(s=int(s));return(n=i._items._list[s])?(!0===o?l.input&&l.input.value(n.text()):l.content&&l.content.html("TemplateItem"===n.ui?n.text():n[0].clone().className(n.opts.defaultClass)),i.select(s,e)):i},itemValue:function(i,t){var e=this,n=null,s=-1,l=e.DOMMap,o=e.editable();if(void 0===i)return e._currentItem?e._currentItem.value():null;if(e.DOMMap.list||e.initList(),isWidget(i)){if(-1===(s=e._items.indexOf(i)))return e;n=i}return-1==s&&e._items.items(function(t,e){if(e.value()==i)return n=e,s=t,!1}),null===n?e.select(s):(!0===o?l.input&&l.input.value(n.text()):l.content&&l.content.html("TemplateItem"===n.ui?n.text():n[0].clone().className(n.opts.defaultClass)),e.select(s,t))},filterList:function(i){var n=this,s=[];return n.DOMMap.dataList||n.initList(),n._items.items(function(t,e){Std.dom(e).detach(),"text"in e&&e.text().has(i)&&(s.push(e),n.DOMMap.list.append(e))}),n._currentFilterItems=s},open:function(t){var e=this,i=e.opts,n=e.DOMMap,s=e[0].offset(),l=(n.list||e.initList(),n.handle.addClass("_open"),n.list.removeStyle("height").appendTo("body"),n.list.show(),e.items(function(t,e){e.rendered||e.render()}),n.list.outerHeight()),o=!1,u=0,a=u=s.y+e.height(),r=n.list.boxSize().height,u=(l>i.listMaxHeight&&(l=i.listMaxHeight),s.y+1+e.height()+l>Std.dom(window).height()&&(o=!0,a=(u=s.y)-l,n.list.addClass("_top")),n.list.css({top:u,left:s.x,zIndex:++Std.ui.status.zIndex,outerWidth:e.width()}),{top:a,height:l-r,opacity:1,transform:"scaleY(1) translateY(0px)"});return!1===t||e._listVisible||!1===i.listAnimation?n.list.css(u):n.list.css({overflow:"hidden",height:0,opacity:0,transform:"scaleY(0) translateY("+(o?"":"-")+(l-r)/2+"px)"}).animateTo(u,{duration:150,timingFunction:"ease-out"},function(){n.list.removeStyle("overflow")}),e._listVisible||(e.emit("open"),e._listVisible=!0),setTimeout(function(){e.addDocumentEvents()},1),e},close:function(t){var e=this,i=e.opts,n=e.DOMMap;if(!n.list||!e._listVisible)return e;var s=n.list.hasClass("_top"),l=n.list.boxSize().height,o=n.list.outerHeight(),u=e[0].offset().y;return n.handle.removeClass("_open"),!1===t||!1===i.listAnimation?(n.list.height(0),n.list.hide()):n.list.css({overflow:"hidden",height:o-l}).animateTo({opacity:0,height:0,top:s?u:u+e.height(),transform:"scaleY(0) translateY("+(s?"":"-")+(o-l)/2+"px)"},{duration:150,timingFunction:"ease-in"},function(){n.list.removeClass("_top").detach()}),null!==e._selectedItem&&e._selectedItem.removeClass("selected"),null!==e._currentItem&&(e._selectedItem=e._currentItem.addClass("selected")),e.delDocumentEvents(),e._listVisible=!1,e.emit("close")},prepend:function(t,e){return this.insert(t,e,0)},insert:function(t,e,i){return this._items.insert(t,e,i)},append:function(t,e){var i=this;return isArray(t)?Std.each(t,function(t,e){return i._items.append(e)},!0):i._items.append(t,e)},clear:function(){var t=this._items;return t.items(function(t,e){e.remove()}),t.clear(),this._currentItem=null,this}},k:function(i,t){i.DOMMap={},i._items=Std.items(function(t,e){if(isWidget(t=i.createItem(t)))return isString(e.name)?t.name(e.name):isString(t.opts.name)&&(e.name=t.opts.name),i.DOMMap.list&&(i.DOMMap.list.insert(Std.dom.get(t),e.index),i._listVisible&&t.render()),t}),i.initHandle(),i.editable(t.editable),null!==t.items&&i.append(t.items),null!==t.template&&i.template(t.template)},m:{rule:{children:"append",content:"value"},html:{nodeName:["DIV"],create:function(t){var l=this;t.children(function(t,e){var i={},n=e.attr("std-icon"),s=e.html();isString(s)&&(i.text=s.trim()),isString(n)&&(i.icon=n),l.append(e.attr("std-name"),Std.extend(i,Std.options.get(e),3))})}}}});
"undefined;"