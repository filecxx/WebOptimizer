
Std.ui.module("MenuBar",{b:"widget",e:{defaultClass:"StdUI_MenuBar",level:3,minHeight:16,items:null},h:{state:0,selectedIndex:-1},n:{initKeyboard:function(){var i=this,s=!1,e=Std.dom(document);e.on("mousedown",i._mousedown=function(e){var e=e.target,t=i.currentSelected();t&&t.menu&&Std.dom(t.menu).contains(e)||!i[1].is(e)&&i[1].contains(e)||i.clearStates()}),e.on("keyup",i._keyup=function(e){!0===s&&i.enable()&&(i.updateLabels(),s=!1)}),e.on("keydown",i._keydown=function(n){var e=Std.dom(n.target),t=i[0].offsetParent();t&&(e.is(t)||t.contains(e))&&i[0].visible()&&i.enable()&&(18===n.keyCode?(i.updateLabels(s=!0),n.preventDefault()):27===n.keyCode?i.clearStates():n.altKey&&(i._items.items(function(e,t){if(-1!==t.text.toUpperCase().indexOf("&"+String.fromCharCode(n.keyCode)))return e===i._selectedIndex?i.clearStates():i.select(e),i.focus(),!0}),n.preventDefault()))}),i[0].on("keydown",function(e){i.enable()&&i.keyEvent(e)})},initEvents:function(){var n=this,i=!1;n[0].on("mouseenter","._item",function(e){var t=this.index();n.enable()&&this.mouse({auto:!1,click:function(){t!==n._selectedIndex?n.select(t):n.clearStates()}},e),i||n[0].unselect(i=!0),n.enable()&&1==n._state&&n.select(t)})}},g:{render:function(){},height:function(n){var e=this;isNumber(n)||(n=e.height()),e[1].lineHeight(n-=e.boxSize.height),e._items.items(function(e,t){t.iconElem&&t.iconElem.marginTop((n-t.iconElem.height())/2)})},destroy:function(){var e=this;Std.dom(document).off({keydown:e._keydown,keyup:e._keyup,mousedown:e._mousedown}),e._items.items(function(e,t){t.menu&&t.menu.remove()})},remove:function(e){var t=this,n=null;isObject(e)&&(e=t._items.indexOf(e)),(isNumber(e)||isString(e))&&(n=t._items.items(e))&&(n.menu&&n.menu.remove(),n.elem.remove(),t._items.removeItem(e))}},i:{keyEvent:function(e){var t=this,n=t._items.length,i=t._selectedIndex;switch(e.keyCode){case 37:t.select((i=i<=0?n:i)-1);break;case 39:t.select((i=n-1<=i?-1:i)+1);break;case 40:var s=t._items.items(i).menu.focus();null==s._currentItem&&s.select(0)}},showMenu:function(){var e,t=this,n=t.currentSelected();return n&&(e=n.elem.offset(),(n=n.menu)&&n.show()[0].css({left:e.x,top:e.y+t.height()})),t},createItem:function(e){var t=newDiv("_item").appendTo(this[1]),n=null,i=null,n=(isEmpty(e.icon)||Std.icon.update(n=newDiv("_icon").appendTo(t),e.icon,{width:null,height:null}),{elem:t,iconElem:n,textElem:i=isString(e.text)?newDiv("_text").html(e.text.replace("&","")).appendTo(t):i,name:e.name,text:e.text,items:e.items});return isObject(e.items)?n.items=e.items:e.menu&&(isWidget(e.menu)?n.menu=e.menu:isPlainObject(e.menu)&&(n.menu=Std.ui(e.menu.ui||"Menu",e.menu))),n},formatLabel:function(e){var t="";if(-1==e.indexOf("&"))return e;for(var n=0,i=e.length;n<i;n++){var s=e.charAt(n);t+="&"===s&&n+1<i?"<span style='text-decoration: underline'>"+e.charAt(++n)+"</span>":s}return t},updateLabels:function(i){var s=this;return s._items.items(function(e,t){var n="",n=!0===i?s.formatLabel(t.text):t.text.replace(/&/,"");t.textElem.html(n)}),s},clearStates:function(){var e=this.currentSelected();return e&&null!==e.menu&&(e.elem.removeClass("selected"),e.menu&&e.menu.hide(),this._selectedIndex=-1,this._state=0),this},currentSelected:function(){return-1===this._selectedIndex?null:this._items._list[this._selectedIndex]}},j:{items:function(e,t){return this._items.items(e,t)},itemCount:function(){return this._items.length},select:function(e){var t=this,n=t._items._list[e];return null==n?t:(!n.menu&&n.items&&(n.menu=Std.ui("Menu",{items:n.items})),n.menu&&!n.menu.rendered&&(n.menu instanceof Std.ui("Menu")&&n.menu.on("itemPress",function(){t.clearStates()}),n.menu[0].css("position","absolute"),n.menu.parent(t).renderTo("body")),t.clearStates(),n.elem.addClass("selected"),t._state=1,t._selectedIndex=e,t.showMenu())},append:function(e,t){var n=this;return isArray(e)?Std.each(e,function(e,t){return n._items.append(t)},!0):n._items.append(e,t)}},k:function(n,e,t){n._items=Std.items(function(e,t){if(e=n.createItem(e))return isString(t.name)?e.name(t.name):isString(e.name)&&(t.name=e.name),e}),n.initEvents(),n.initKeyboard(),t.append(n[1]=newDiv("_items")),e.items&&n.append(e.items)},support:{rule:{children:"append"},html:{nodeName:["DIV"],create:function(e){this.append(e.children(function(e,t){var n=t.attr("std-ui"),i={icon:t.attr("std-icon"),text:t.attr("title"),action:t.attr("std-action")};return n&&Std.ui(n)&&(i.menu=Std.ui.build(t,!1)),Std.extend(i,Std.options.get(t))}))}}}});
"undefined;"