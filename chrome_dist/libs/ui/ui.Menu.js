
Std.ui.module("MenuItem",{b:"Item",c:"checked",e:{defaultClass:"StdUI_MenuItem",text:"menu item",checkable:!1,toggleable:!0,checked:!1,subtext:null,items:null,root:null},h:{childVisible:!1},g:{render:function(){var e=this,t=e.opts,i=e.DOMMap;null!==t.items&&(i.cells||(i.cells=newDiv("_cells").appendTo(e[0])),i.cells.append(i.open=newDiv("_open")))},destroy:function(){var e=this;e.menu&&e.menu.destroy(),e._items&&e._items.clear()},remove:function(e){void 0!==e&&this.menu&&this.menu.remove(e)}},j:{checkable:function(e){return this.opt("checkable",e)},toggleable:function(e){return this.opt("toggleable",e)},root:function(e){var t=this,i=t.opts;return void 0===e?i.root||t:(i.root=e,t)},subtext:function(e){var t=this,i=t.DOMMap;return this.opt("subtext",e,function(){i.cells||(i.cells=newDiv("_cells").appendTo(t[0])),i.subtext||(i.subtext=newDiv("_subtext").prependTo(i.cells)),i.subtext.html(e)})},checked:function(e){var t=this,i=t.DOMMap;return t.checkable()?t.opt("checked",e,function(){i.icon.toggleClass("checked",e),t.rendered&&t.emit("checked",e)}):void 0===e?t.opts.checked:t},insert:function(e,t){var i=this,n=i.DOMMap;return i.menu?i.menu.insert(e,t):(i._items||(i._items=[]),i._items.insert(e,t)),n.cells||(n.cells=newDiv("_cells").appendTo(i[0])),n.open||n.cells.append(n.open=newDiv("_open")),i},append:Std.func(function(e){return this.insert(e)},{each:[isArray]}),showChild:function(){var e=this,t=e[0].offset();return e._childVisible||(e.menu||(e.menu=Std.ui("Menu",{parent:e,items:e._items,root:e.root(),renderTo:"body"})),e.menu.visible(e._childVisible=!0).toForeground(),e.menu[0].css({position:"absolute",left:t.x+e.width(),top:t.y,margin:0})),e},hideChild:function(e){var t=this;return t.menu&&(!1===e?t.menu.visible(t._childVisible=!1):t.menu[0].animateTo({opacity:0},100,function(){t.menu.visible(t._childVisible=!1)})),t},childVisible:function(e){var t=this;return void 0===e?t._childVisible:(e===t._childVisible||(!0===t._childVisible?t.showChild():t.hideChild()),t)}},k:function(e,t,i){var n=e.DOMMap;t.items&&(e._items=Array.from(t.items)),n.icon||e.initIcon(),n.text||i.append(n.text=newDiv("_text")),t.checkable&&t.checked&&e.checked(!0),t.subtext?e.subtext(t.subtext):t.action&&(i=Std.action(t.action))&&i.opts.hotKey&&e.subtext(i.opts.hotKey)},m:{rule:{content:"text",children:"append"},html:{create:function(e,t){this.append(Std.each(t,function(e,t){var i=t.attr("std-ui");return i&&Std.ui(i)?Std.ui.build(t,!1):t.html().trim()},!0))}}}}),Std.ui.module("Menu",{b:"widget",c:"itemPress",e:{defaultClass:"StdUI_Menu",level:1,items:null,root:null,width:"auto",height:"auto",theme:"default"},h:{currentItem:null},n:{initItems:function(){var i=this,e=i.opts;i._items=Std.items(function(e,t){if(isWidget(e=i.createItem(e)))return isString(t.name)?e.name(t.name):isString(e.name())&&(t.name=e.name()),i[0].insert(e,t.index),i.rendered&&e.render(),e}),null!=e.items&&i.append(e.items)},initKeyboard:function(){var i=this;i[0].on({contextmenu:function(e){return!1},keydown:function(e){var t=i._items.indexOf(i._currentItem);if(-1!=t&&i.enable())return i.keyEvent(e.keyCode,i._currentItem,t)}})},initEvents:function(){var n=this,s=!1;n[0].delegate("mouseenter mouseleave mousedown click",">.StdUI_MenuItem",function(e){var t=n._items._list[this.index()],i=e.name;!1===s&&n[0].unselect(s=!0),n.enable()&&t.enable()&&"sep"!==t.ui&&("click"===i?(t.toggleable()&&t.checkable()&&t.checked(!t.checked()),n.root().emit("itemPress",t.emit("press"))):"mousedown"===i?e.stopPropagation():"mouseenter"==i?n.select(t):"mouseleave"!=i||t.childVisible()||n.select(!1))})}},g:{render:function(){this._items.items(function(e,t){t.rendered||t.render()})},visible:function(e){!0===e?this[0].css("zIndex",++Std.ui.status.zIndex):(this.select(!1),this._items.items(function(e,t){t._childVisible&&t.hideChild()}))},destroy:function(){this.clear()},remove:function(e){var t=null;isObject(e)&&(e=this._items.indexOf(e)),(isNumber(e)||isString(e))&&(t=this._items.items(e))&&(t.destroy(),this._items.remove(e))}},i:{keyEvent:function(e,t,i){function n(e){return!e.enable()||"MenuItem"!==e.ui}var s=this,r=0,u=s._items,o=s.parent();if(13===e)s.root().emit("itemPress",t.emit("press"));else{if(27!==e)return 37===e?(t.hideChild(),o&&"MenuItem"===o.ui&&(o.focus().hideChild(),o.parent().focus()),!1):38===e?(function(e){++r>u.length||(e=--e<0?u.length-1:e,n(u._list[e])?arguments.callee(e):s.select(e))}(i),!1):39===e?(t.menu&&(t.showChild(),t.menu.focus().select(0)),!1):40===e?(function(e){++r>u.length||(e=++e>=u.length?0:e,n(u._list[e])?arguments.callee(e):s.select(e))}(i),!1):void 0;isWidget(o)&&(s.hide(),("MenuItem"===o.ui?o.parent():o).focus())}},createItem:function(e){var t=null,i=this.root();return isWidget(e)?t=e.parent(this):Std.is.action(e)?t=Std.ui("MenuItem",{root:i,parent:this,action:e}):isObject(e)?(e.root=i,e.parent=this,t=Std.ui(e.ui||"MenuItem",e)):(isString(e)||isNumber(e))&&(t=Std.ui("MenuItem",{text:e+"",root:i,parent:this})),t}},j:{items:function(e,t){return this._items.items(e,t)},itemCount:function(){return this._items.length},root:function(e){var t=this.opts;return void 0===e?t.root||this:(t.root=e,this)},prepend:function(e,t){return this._items.insert(e,t,0)},insert:function(e,t,i){return this._items.insert(e,t,i)},append:function(e,t){var i=this;return isArray(e)?Std.each(e,function(e,t){i._items.append(t)},!0):i._items.append(e,t)},clear:function(){var e=this._items;return e.items(function(e,t){t.destroy()}),e.clear(),this},select:function(e){var t=this;return e===t._currentItem?t:(t._currentItem&&(t._currentItem.removeClass("selected").hideChild(!1),t._currentItem=null),!1===e?t:((isNumber(e)||isString(e))&&(e=t._items.items(e)),isWidget(e)&&"MenuItem"===e.ui&&e.enable()&&(t._currentItem=e.addClass("selected")).DOMMap.open&&e.showChild(),t))}},k:function(e){e.initItems(),e.initEvents(),e.initKeyboard()},m:{rule:{children:"append"},html:{create:function(e){var s=function(e){return e.children(function(e,t){var i,n=t.attr("std-ui");return n&&Std.ui(n)?Std.ui.build(t,!1):(t=(n=t).attr("title"),i={name:n.attr("std-name"),icon:n.attr("std-icon"),action:n.attr("std-action")},t?(i.text=t,i.items=s(n)):isEmpty(t=n.trimHTML())||(i.text=t),n.clear(),Std.dom(n).ui("MenuItem",Std.extend(i,Std.options.get(n))))})};this.append(s(e))}}}});
"undefined;"